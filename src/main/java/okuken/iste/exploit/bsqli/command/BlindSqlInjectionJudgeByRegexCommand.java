package okuken.iste.exploit.bsqli.command;

import java.util.regex.Pattern;

import okuken.iste.exploit.bsqli.dto.BlindSqlInjectionJudgeDto;
import okuken.iste.util.ByteUtil;

public class BlindSqlInjectionJudgeByRegexCommand implements BlindSqlInjectionJudgeCommand {

	private final String regex;
	private final Pattern regexPattern;
	private final boolean invert;

	BlindSqlInjectionJudgeByRegexCommand(String regex, boolean invert) {
		this.regex = regex;
		this.regexPattern = Pattern.compile(regex);
		this.invert = invert;
	}

	@Override
	public boolean judge(BlindSqlInjectionJudgeDto judgeDto) {
		var found = regexPattern.matcher(new String(judgeDto.getResponse(), ByteUtil.DEFAULT_SINGLE_BYTE_CHARSET)).find();
		return invert ? !found : found; 
	}

	@Override
	public String toString() {
		return new StringBuilder()
				.append(invert ? "not found \"" : "found \"")
				.append(regex)
				.append("\"")
				.toString();
	}
}
